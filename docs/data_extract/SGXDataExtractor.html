<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, minimum-scale=1"
    />
    <meta name="generator" content="pdoc 0.10.0" />
    <title>data_extract.SGXDataExtractor API documentation</title>
    <meta name="description" content="" />
    <link
      rel="preload stylesheet"
      as="style"
      href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css"
      integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs="
      crossorigin
    />
    <link
      rel="preload stylesheet"
      as="style"
      href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css"
      integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg="
      crossorigin
    />
    <link
      rel="stylesheet preload"
      as="style"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css"
      crossorigin
    />
    <style>
      :root {
        --highlight-color: #fe9;
      }
      .flex {
        display: flex !important;
      }
      body {
        line-height: 1.5em;
      }
      #content {
        padding: 20px;
      }
      #sidebar {
        padding: 30px;
        overflow: hidden;
      }
      #sidebar > *:last-child {
        margin-bottom: 2cm;
      }
      .http-server-breadcrumbs {
        font-size: 130%;
        margin: 0 0 15px 0;
      }
      #footer {
        font-size: 0.75em;
        padding: 5px 30px;
        border-top: 1px solid #ddd;
        text-align: right;
      }
      #footer p {
        margin: 0 0 0 1em;
        display: inline-block;
      }
      #footer p:last-child {
        margin-right: 30px;
      }
      h1,
      h2,
      h3,
      h4,
      h5 {
        font-weight: 300;
      }
      h1 {
        font-size: 2.5em;
        line-height: 1.1em;
      }
      h2 {
        font-size: 1.75em;
        margin: 1em 0 0.5em 0;
      }
      h3 {
        font-size: 1.4em;
        margin: 25px 0 10px 0;
      }
      h4 {
        margin: 0;
        font-size: 105%;
      }
      h1:target,
      h2:target,
      h3:target,
      h4:target,
      h5:target,
      h6:target {
        background: var(--highlight-color);
        padding: 0.2em 0;
      }
      a {
        color: #058;
        text-decoration: none;
        transition: color 0.3s ease-in-out;
      }
      a:hover {
        color: #e82;
      }
      .title code {
        font-weight: bold;
      }
      h2[id^="header-"] {
        margin-top: 2em;
      }
      .ident {
        color: #900;
      }
      pre code {
        background: #f8f8f8;
        font-size: 0.8em;
        line-height: 1.4em;
      }
      code {
        background: #f2f2f1;
        padding: 1px 4px;
        overflow-wrap: break-word;
      }
      h1 code {
        background: transparent;
      }
      pre {
        background: #f8f8f8;
        border: 0;
        border-top: 1px solid #ccc;
        border-bottom: 1px solid #ccc;
        margin: 1em 0;
        padding: 1ex;
      }
      #http-server-module-list {
        display: flex;
        flex-flow: column;
      }
      #http-server-module-list div {
        display: flex;
      }
      #http-server-module-list dt {
        min-width: 10%;
      }
      #http-server-module-list p {
        margin-top: 0;
      }
      .toc ul,
      #index {
        list-style-type: none;
        margin: 0;
        padding: 0;
      }
      #index code {
        background: transparent;
      }
      #index h3 {
        border-bottom: 1px solid #ddd;
      }
      #index ul {
        padding: 0;
      }
      #index h4 {
        margin-top: 0.6em;
        font-weight: bold;
      }
      @media (min-width: 200ex) {
        #index .two-column {
          column-count: 2;
        }
      }
      @media (min-width: 300ex) {
        #index .two-column {
          column-count: 3;
        }
      }
      dl {
        margin-bottom: 2em;
      }
      dl dl:last-child {
        margin-bottom: 4em;
      }
      dd {
        margin: 0 0 1em 3em;
      }
      #header-classes + dl > dd {
        margin-bottom: 3em;
      }
      dd dd {
        margin-left: 2em;
      }
      dd p {
        margin: 10px 0;
      }
      .name {
        background: #eee;
        font-weight: bold;
        font-size: 0.85em;
        padding: 5px 10px;
        display: inline-block;
        min-width: 40%;
      }
      .name:hover {
        background: #e0e0e0;
      }
      dt:target .name {
        background: var(--highlight-color);
      }
      .name > span:first-child {
        white-space: nowrap;
      }
      .name.class > span:nth-child(2) {
        margin-left: 0.4em;
      }
      .inherited {
        color: #999;
        border-left: 5px solid #eee;
        padding-left: 1em;
      }
      .inheritance em {
        font-style: normal;
        font-weight: bold;
      }
      .desc h2 {
        font-weight: 400;
        font-size: 1.25em;
      }
      .desc h3 {
        font-size: 1em;
      }
      .desc dt code {
        background: inherit;
      }
      .source summary,
      .git-link-div {
        color: #666;
        text-align: right;
        font-weight: 400;
        font-size: 0.8em;
        text-transform: uppercase;
      }
      .source summary > * {
        white-space: nowrap;
        cursor: pointer;
      }
      .git-link {
        color: inherit;
        margin-left: 1em;
      }
      .source pre {
        max-height: 500px;
        overflow: auto;
        margin: 0;
      }
      .source pre code {
        font-size: 12px;
        overflow: visible;
      }
      .hlist {
        list-style: none;
      }
      .hlist li {
        display: inline;
      }
      .hlist li:after {
        content: ",\2002";
      }
      .hlist li:last-child:after {
        content: none;
      }
      .hlist .hlist {
        display: inline;
        padding-left: 1em;
      }
      img {
        max-width: 100%;
      }
      td {
        padding: 0 0.5em;
      }
      .admonition {
        padding: 0.1em 0.5em;
        margin-bottom: 1em;
      }
      .admonition-title {
        font-weight: bold;
      }
      .admonition.note,
      .admonition.info,
      .admonition.important {
        background: #aef;
      }
      .admonition.todo,
      .admonition.versionadded,
      .admonition.tip,
      .admonition.hint {
        background: #dfd;
      }
      .admonition.warning,
      .admonition.versionchanged,
      .admonition.deprecated {
        background: #fd4;
      }
      .admonition.error,
      .admonition.danger,
      .admonition.caution {
        background: lightpink;
      }
    </style>
    <style media="screen and (min-width: 700px)">
      @media screen and (min-width: 700px) {
        #sidebar {
          width: 30%;
          height: 100vh;
          overflow: auto;
          position: sticky;
          top: 0;
        }
        #content {
          width: 70%;
          max-width: 100ch;
          padding: 3em 4em;
          border-left: 1px solid #ddd;
        }
        pre code {
          font-size: 1em;
        }
        .item .name {
          font-size: 1em;
        }
        main {
          display: flex;
          flex-direction: row-reverse;
          justify-content: flex-end;
        }
        .toc ul ul,
        #index ul {
          padding-left: 1.5em;
        }
        .toc > ul > li {
          margin-top: 0.5em;
        }
      }
    </style>
    <style media="print">
      @media print {
        #sidebar h1 {
          page-break-before: always;
        }
        .source {
          display: none;
        }
      }
      @media print {
        * {
          background: transparent !important;
          color: #000 !important;
          box-shadow: none !important;
          text-shadow: none !important;
        }
        a[href]:after {
          content: " (" attr(href) ")";
          font-size: 90%;
        }
        a[href][title]:after {
          content: none;
        }
        abbr[title]:after {
          content: " (" attr(title) ")";
        }
        .ir a:after,
        a[href^="javascript:"]:after,
        a[href^="#"]:after {
          content: "";
        }
        pre,
        blockquote {
          border: 1px solid #999;
          page-break-inside: avoid;
        }
        thead {
          display: table-header-group;
        }
        tr,
        img {
          page-break-inside: avoid;
        }
        img {
          max-width: 100% !important;
        }
        @page {
          margin: 0.5cm;
        }
        p,
        h2,
        h3 {
          orphans: 3;
          widows: 3;
        }
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
          page-break-after: avoid;
        }
      }
    </style>
    <script
      defer
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"
      integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8="
      crossorigin
    ></script>
    <script>
      window.addEventListener("DOMContentLoaded", () =>
        hljs.initHighlighting()
      );
    </script>
  </head>
  <body>
    <main>
      <article id="content">
        <header>
          <h1 class="title">
            Module <code>data_extract.SGXDataExtractor</code>
          </h1>
        </header>
        <section id="section-intro">
          <details class="source">
            <summary>
              <span>Expand source code</span>
            </summary>
            <pre><code class="python">import pandas as pd
from urllib.request import Request, urlopen
import json
from data_load.bigQueryAPI import bigQueryDB


class SGXDataExtractor:
    def __init__(self):
        with open(&#39;utils/serviceAccount.json&#39;, &#39;r&#39;) as jsonFile:
            self.cred = json.load(jsonFile)
        self.url = self.cred[&#34;dataSources&#34;][&#34;sgx_api&#34;]
        self.url_request = None
        self.json_data = None
        self.SGX_data_store = None
        self.updated_SGX_data_store = None
        print(&#34;INFO: SGXDataExtractor Initialised&#34;)

    def extract_SGX_json_data(self):
        &#34;&#34;&#34;Helper function to extract information from JSON output
        &#34;&#34;&#34;
        print(&#34;INFO: Extracting SGX Data from API&#34;)
        self.url_request = self.url_request = Request(
            self.url, headers={&#39;User-Agent&#39;: &#39;Mozilla/5.0&#39;})
        self.json_data = json.loads(urlopen(self.url_request).read())[
            &#34;data&#34;][&#34;prices&#34;]
        print(&#34;SUCCESS: SGX Data Successfully Extracted&#34;)

    def populate_SGX_data(self):
        &#34;&#34;&#34;Helper function to populate data from SGX JSON output
        &#34;&#34;&#34;
        print(&#34;INFO: Populating SGX Data Store&#34;)
        SGX_data_store = {
            &#34;company_name&#34;: [],
            &#34;ticker&#34;: [],
            &#34;trading_time&#34;: [],
            &#34;type&#34;: [],
            &#34;listing_board&#34;: []
        }
        for company in self.json_data:
            SGX_data_store[&#34;company_name&#34;].append(company[&#34;n&#34;])
            SGX_data_store[&#34;ticker&#34;].append(company[&#34;nc&#34;])
            SGX_data_store[&#34;trading_time&#34;].append(company[&#34;trading_time&#34;])
            SGX_data_store[&#34;type&#34;].append(company[&#34;type&#34;])
            SGX_data_store[&#34;listing_board&#34;].append(company[&#34;m&#34;])

        self.SGX_data_store = pd.DataFrame(SGX_data_store).dropna()
        self.SGX_data_store[&#39;active&#39;] = True
        print(&#34;SUCCESS: SGX Data successfully populated&#34;)

    def get_SGXData_from_GBQ(self):
        &#34;&#34;&#34;Helper function to query SGX Ticker Table from BigQuery

        Returns:
            dataframe: Data from the SGX Ticker Table in BigQuery
        &#34;&#34;&#34;
        if bigQueryDB().gbqCheckTableExist(&#34;SGX.Tickers&#34;):
            return bigQueryDB().getDataFields(&#34;SGX.Tickers&#34;)
        else:
            return None

    # Checks scrapped data with ticker data from GBQ to update their &#39;active&#39; status
    def update_ticker_status(self, SGX_data_store, GBQ_SGX_ticker_df):
        &#34;&#34;&#34;This module checks newly extracted SGX data against BigQuery SGX Ticker Table and updates the ticker statuses
        Case 1 - Newly listed tickers
        Case 2 - Previously delisted tickers
        Case 3 - Newly delisted tickers
        Case 4 - Previously delisted tickers that are now active

        Args:
            SGX_data_store (list): List of existing tickers from SGX Website
            GBQ_SGX_ticker_df (dataframe): Dataframe of tickers from SGX.Ticker Table

        Returns:
            datafarme: Dataframe of tickers and updated statuses
        &#34;&#34;&#34;
        print(&#34;INFO: Updating ticker status&#34;)
        # 4 Cases to consider
        # Case 1 - Newly listed tickers
        # Case 2 - Previously delisted tickers
        # Case 3 - Newly delisted tickers
        # Case 4 - Previously delisted tickers that are now active

        # Getting active SGX tickers dataframe
        active_SGX_ticker_df = SGX_data_store
        active_SGX_ticker_list = active_SGX_ticker_df.ticker.to_list()

        if GBQ_SGX_ticker_df is None:
            self.updated_SGX_data_store = self.SGX_data_store
            return self.updated_SGX_data_store

        # Getting the list/dataframe of tickers from GBQ (Active and delisted)
        active_GBQ_ticker_df = GBQ_SGX_ticker_df[GBQ_SGX_ticker_df[&#39;active&#39;] == True]
        delisted_GBQ_ticker_df = GBQ_SGX_ticker_df[GBQ_SGX_ticker_df[&#39;active&#39;] == False]

        active_GBQ_ticker_list = active_GBQ_ticker_df.ticker.to_list()

        # This list contains either active tickers from SGX only or active tickers from GBQ only
        active_SGX_xor_active_GBQ_list = list(
            set(active_SGX_ticker_list) ^ set(active_GBQ_ticker_list))

        # Merges all tickers from SGX data store (all active - case 1 considered) and delisted GBQ dataframe (contains previously delisted tickers - case 2 is considered)
        # By dropping duplicates and keeping only the active one, case 4 is considered
        unique_columns = [&#34;company_name&#34;, &#34;ticker&#34;,
                          &#34;trading_time&#34;, &#34;type&#34;, &#34;listing_board&#34;]
        updated_SGX_data = pd.concat([active_SGX_ticker_df, delisted_GBQ_ticker_df]).drop_duplicates(
            subset=unique_columns, keep=&#39;first&#39;)

        for ticker in active_SGX_xor_active_GBQ_list:
            if ticker not in active_SGX_ticker_list:  # Changing status for newly delisted tickers - case 3 is considered
                newly_delisted_entry = active_GBQ_ticker_df.loc[active_GBQ_ticker_df[&#39;ticker&#39;] == ticker].copy(
                )

                newly_delisted_entry[&#39;active&#39;] = False
                updated_SGX_data = pd.concat(
                    [updated_SGX_data, newly_delisted_entry])

        self.updated_SGX_data_store = updated_SGX_data.sort_values(
            [&#39;company_name&#39;, &#39;ticker&#39;]).reset_index(drop=True)

        self.updated_SGX_data_store = self.updated_SGX_data_store.drop_duplicates()

        print(&#34;SUCCESS: Ticker status Updated&#34;)

        return self.updated_SGX_data_store

    def SGX_data_to_csv(self):
        &#34;&#34;&#34;This helper function outputs SGX Data to CSV
        &#34;&#34;&#34;
        self.updated_SGX_data_store.to_csv(&#34;SGX_data.csv&#34;, index=False)
        print(&#34;SUCCESS: SGX Data successfully saved to CSV&#34;)

    def SGX_data_to_bg(self):
        &#34;&#34;&#34;This helper function loads SGX Data into BigQuery

        Returns:
            boolean: Success/Failure of the loading of SGX Data
        &#34;&#34;&#34;
        if bigQueryDB().gbqCheckTableExist(&#34;SGX.Tickers&#34;):
            return bigQueryDB().gbqReplace(self.updated_SGX_data_store, &#34;SGX.Tickers&#34;)
        else:
            return bigQueryDB().gbqCreateNewTable(self.updated_SGX_data_store, &#34;SGX&#34;, &#34;Tickers&#34;)

    def load_SGX_data_from_source(self):
        &#34;&#34;&#34;This function calls extract and populate SGX data
        &#34;&#34;&#34;
        self.extract_SGX_json_data()
        self.populate_SGX_data()

    def get_SGX_data(self):
        &#34;&#34;&#34;This function calls extract and populate SGX data

        Returns:
            dataframe: Current SGX Ticker and information from SGX
        &#34;&#34;&#34;
        self.extract_SGX_json_data()
        self.populate_SGX_data()
        return self.SGX_data_store</code></pre>
          </details>
        </section>
        <section></section>
        <section></section>
        <section></section>
        <section>
          <h2 class="section-title" id="header-classes">Classes</h2>
          <dl>
            <dt id="data_extract.SGXDataExtractor.SGXDataExtractor">
              <code class="flex name class">
                <span>class <span class="ident">SGXDataExtractor</span></span>
              </code>
            </dt>
            <dd>
              <div class="desc"></div>
              <details class="source">
                <summary>
                  <span>Expand source code</span>
                </summary>
                <pre><code class="python">class SGXDataExtractor:
    def __init__(self):
        with open(&#39;utils/serviceAccount.json&#39;, &#39;r&#39;) as jsonFile:
            self.cred = json.load(jsonFile)
        self.url = self.cred[&#34;dataSources&#34;][&#34;sgx_api&#34;]
        self.url_request = None
        self.json_data = None
        self.SGX_data_store = None
        self.updated_SGX_data_store = None
        print(&#34;INFO: SGXDataExtractor Initialised&#34;)

    def extract_SGX_json_data(self):
        &#34;&#34;&#34;Helper function to extract information from JSON output
        &#34;&#34;&#34;
        print(&#34;INFO: Extracting SGX Data from API&#34;)
        self.url_request = self.url_request = Request(
            self.url, headers={&#39;User-Agent&#39;: &#39;Mozilla/5.0&#39;})
        self.json_data = json.loads(urlopen(self.url_request).read())[
            &#34;data&#34;][&#34;prices&#34;]
        print(&#34;SUCCESS: SGX Data Successfully Extracted&#34;)

    def populate_SGX_data(self):
        &#34;&#34;&#34;Helper function to populate data from SGX JSON output
        &#34;&#34;&#34;
        print(&#34;INFO: Populating SGX Data Store&#34;)
        SGX_data_store = {
            &#34;company_name&#34;: [],
            &#34;ticker&#34;: [],
            &#34;trading_time&#34;: [],
            &#34;type&#34;: [],
            &#34;listing_board&#34;: []
        }
        for company in self.json_data:
            SGX_data_store[&#34;company_name&#34;].append(company[&#34;n&#34;])
            SGX_data_store[&#34;ticker&#34;].append(company[&#34;nc&#34;])
            SGX_data_store[&#34;trading_time&#34;].append(company[&#34;trading_time&#34;])
            SGX_data_store[&#34;type&#34;].append(company[&#34;type&#34;])
            SGX_data_store[&#34;listing_board&#34;].append(company[&#34;m&#34;])

        self.SGX_data_store = pd.DataFrame(SGX_data_store).dropna()
        self.SGX_data_store[&#39;active&#39;] = True
        print(&#34;SUCCESS: SGX Data successfully populated&#34;)

    def get_SGXData_from_GBQ(self):
        &#34;&#34;&#34;Helper function to query SGX Ticker Table from BigQuery

        Returns:
            dataframe: Data from the SGX Ticker Table in BigQuery
        &#34;&#34;&#34;
        if bigQueryDB().gbqCheckTableExist(&#34;SGX.Tickers&#34;):
            return bigQueryDB().getDataFields(&#34;SGX.Tickers&#34;)
        else:
            return None

    # Checks scrapped data with ticker data from GBQ to update their &#39;active&#39; status
    def update_ticker_status(self, SGX_data_store, GBQ_SGX_ticker_df):
        &#34;&#34;&#34;This module checks newly extracted SGX data against BigQuery SGX Ticker Table and updates the ticker statuses
        Case 1 - Newly listed tickers
        Case 2 - Previously delisted tickers
        Case 3 - Newly delisted tickers
        Case 4 - Previously delisted tickers that are now active

        Args:
            SGX_data_store (list): List of existing tickers from SGX Website
            GBQ_SGX_ticker_df (dataframe): Dataframe of tickers from SGX.Ticker Table

        Returns:
            datafarme: Dataframe of tickers and updated statuses
        &#34;&#34;&#34;
        print(&#34;INFO: Updating ticker status&#34;)
        # 4 Cases to consider
        # Case 1 - Newly listed tickers
        # Case 2 - Previously delisted tickers
        # Case 3 - Newly delisted tickers
        # Case 4 - Previously delisted tickers that are now active

        # Getting active SGX tickers dataframe
        active_SGX_ticker_df = SGX_data_store
        active_SGX_ticker_list = active_SGX_ticker_df.ticker.to_list()

        if GBQ_SGX_ticker_df is None:
            self.updated_SGX_data_store = self.SGX_data_store
            return self.updated_SGX_data_store

        # Getting the list/dataframe of tickers from GBQ (Active and delisted)
        active_GBQ_ticker_df = GBQ_SGX_ticker_df[GBQ_SGX_ticker_df[&#39;active&#39;] == True]
        delisted_GBQ_ticker_df = GBQ_SGX_ticker_df[GBQ_SGX_ticker_df[&#39;active&#39;] == False]

        active_GBQ_ticker_list = active_GBQ_ticker_df.ticker.to_list()

        # This list contains either active tickers from SGX only or active tickers from GBQ only
        active_SGX_xor_active_GBQ_list = list(
            set(active_SGX_ticker_list) ^ set(active_GBQ_ticker_list))

        # Merges all tickers from SGX data store (all active - case 1 considered) and delisted GBQ dataframe (contains previously delisted tickers - case 2 is considered)
        # By dropping duplicates and keeping only the active one, case 4 is considered
        unique_columns = [&#34;company_name&#34;, &#34;ticker&#34;,
                          &#34;trading_time&#34;, &#34;type&#34;, &#34;listing_board&#34;]
        updated_SGX_data = pd.concat([active_SGX_ticker_df, delisted_GBQ_ticker_df]).drop_duplicates(
            subset=unique_columns, keep=&#39;first&#39;)

        for ticker in active_SGX_xor_active_GBQ_list:
            if ticker not in active_SGX_ticker_list:  # Changing status for newly delisted tickers - case 3 is considered
                newly_delisted_entry = active_GBQ_ticker_df.loc[active_GBQ_ticker_df[&#39;ticker&#39;] == ticker].copy(
                )

                newly_delisted_entry[&#39;active&#39;] = False
                updated_SGX_data = pd.concat(
                    [updated_SGX_data, newly_delisted_entry])

        self.updated_SGX_data_store = updated_SGX_data.sort_values(
            [&#39;company_name&#39;, &#39;ticker&#39;]).reset_index(drop=True)

        self.updated_SGX_data_store = self.updated_SGX_data_store.drop_duplicates()

        print(&#34;SUCCESS: Ticker status Updated&#34;)

        return self.updated_SGX_data_store

    def SGX_data_to_csv(self):
        &#34;&#34;&#34;This helper function outputs SGX Data to CSV
        &#34;&#34;&#34;
        self.updated_SGX_data_store.to_csv(&#34;SGX_data.csv&#34;, index=False)
        print(&#34;SUCCESS: SGX Data successfully saved to CSV&#34;)

    def SGX_data_to_bg(self):
        &#34;&#34;&#34;This helper function loads SGX Data into BigQuery

        Returns:
            boolean: Success/Failure of the loading of SGX Data
        &#34;&#34;&#34;
        if bigQueryDB().gbqCheckTableExist(&#34;SGX.Tickers&#34;):
            return bigQueryDB().gbqReplace(self.updated_SGX_data_store, &#34;SGX.Tickers&#34;)
        else:
            return bigQueryDB().gbqCreateNewTable(self.updated_SGX_data_store, &#34;SGX&#34;, &#34;Tickers&#34;)

    def load_SGX_data_from_source(self):
        &#34;&#34;&#34;This function calls extract and populate SGX data
        &#34;&#34;&#34;
        self.extract_SGX_json_data()
        self.populate_SGX_data()

    def get_SGX_data(self):
        &#34;&#34;&#34;This function calls extract and populate SGX data

        Returns:
            dataframe: Current SGX Ticker and information from SGX
        &#34;&#34;&#34;
        self.extract_SGX_json_data()
        self.populate_SGX_data()
        return self.SGX_data_store</code></pre>
              </details>
              <h3>Methods</h3>
              <dl>
                <dt
                  id="data_extract.SGXDataExtractor.SGXDataExtractor.SGX_data_to_bg"
                >
                  <code class="name flex">
                    <span>def <span class="ident">SGX_data_to_bg</span></span
                    >(<span>self)</span>
                  </code>
                </dt>
                <dd>
                  <div class="desc">
                    <p>This helper function loads SGX Data into BigQuery</p>
                    <h2 id="returns">Returns</h2>
                    <dl>
                      <dt><code>boolean</code></dt>
                      <dd>Success/Failure of the loading of SGX Data</dd>
                    </dl>
                  </div>
                  <details class="source">
                    <summary>
                      <span>Expand source code</span>
                    </summary>
                    <pre><code class="python">def SGX_data_to_bg(self):
    &#34;&#34;&#34;This helper function loads SGX Data into BigQuery

    Returns:
        boolean: Success/Failure of the loading of SGX Data
    &#34;&#34;&#34;
    if bigQueryDB().gbqCheckTableExist(&#34;SGX.Tickers&#34;):
        return bigQueryDB().gbqReplace(self.updated_SGX_data_store, &#34;SGX.Tickers&#34;)
    else:
        return bigQueryDB().gbqCreateNewTable(self.updated_SGX_data_store, &#34;SGX&#34;, &#34;Tickers&#34;)</code></pre>
                  </details>
                </dd>
                <dt
                  id="data_extract.SGXDataExtractor.SGXDataExtractor.SGX_data_to_csv"
                >
                  <code class="name flex">
                    <span>def <span class="ident">SGX_data_to_csv</span></span
                    >(<span>self)</span>
                  </code>
                </dt>
                <dd>
                  <div class="desc">
                    <p>This helper function outputs SGX Data to CSV</p>
                  </div>
                  <details class="source">
                    <summary>
                      <span>Expand source code</span>
                    </summary>
                    <pre><code class="python">def SGX_data_to_csv(self):
    &#34;&#34;&#34;This helper function outputs SGX Data to CSV
    &#34;&#34;&#34;
    self.updated_SGX_data_store.to_csv(&#34;SGX_data.csv&#34;, index=False)
    print(&#34;SUCCESS: SGX Data successfully saved to CSV&#34;)</code></pre>
                  </details>
                </dd>
                <dt
                  id="data_extract.SGXDataExtractor.SGXDataExtractor.extract_SGX_json_data"
                >
                  <code class="name flex">
                    <span
                      >def
                      <span class="ident">extract_SGX_json_data</span></span
                    >(<span>self)</span>
                  </code>
                </dt>
                <dd>
                  <div class="desc">
                    <p>
                      Helper function to extract information from JSON output
                    </p>
                  </div>
                  <details class="source">
                    <summary>
                      <span>Expand source code</span>
                    </summary>
                    <pre><code class="python">def extract_SGX_json_data(self):
    &#34;&#34;&#34;Helper function to extract information from JSON output
    &#34;&#34;&#34;
    print(&#34;INFO: Extracting SGX Data from API&#34;)
    self.url_request = self.url_request = Request(
        self.url, headers={&#39;User-Agent&#39;: &#39;Mozilla/5.0&#39;})
    self.json_data = json.loads(urlopen(self.url_request).read())[
        &#34;data&#34;][&#34;prices&#34;]
    print(&#34;SUCCESS: SGX Data Successfully Extracted&#34;)</code></pre>
                  </details>
                </dd>
                <dt
                  id="data_extract.SGXDataExtractor.SGXDataExtractor.get_SGXData_from_GBQ"
                >
                  <code class="name flex">
                    <span
                      >def <span class="ident">get_SGXData_from_GBQ</span></span
                    >(<span>self)</span>
                  </code>
                </dt>
                <dd>
                  <div class="desc">
                    <p>
                      Helper function to query SGX Ticker Table from BigQuery
                    </p>
                    <h2 id="returns">Returns</h2>
                    <dl>
                      <dt><code>dataframe</code></dt>
                      <dd>Data from the SGX Ticker Table in BigQuery</dd>
                    </dl>
                  </div>
                  <details class="source">
                    <summary>
                      <span>Expand source code</span>
                    </summary>
                    <pre><code class="python">def get_SGXData_from_GBQ(self):
    &#34;&#34;&#34;Helper function to query SGX Ticker Table from BigQuery

    Returns:
        dataframe: Data from the SGX Ticker Table in BigQuery
    &#34;&#34;&#34;
    if bigQueryDB().gbqCheckTableExist(&#34;SGX.Tickers&#34;):
        return bigQueryDB().getDataFields(&#34;SGX.Tickers&#34;)
    else:
        return None</code></pre>
                  </details>
                </dd>
                <dt
                  id="data_extract.SGXDataExtractor.SGXDataExtractor.get_SGX_data"
                >
                  <code class="name flex">
                    <span>def <span class="ident">get_SGX_data</span></span
                    >(<span>self)</span>
                  </code>
                </dt>
                <dd>
                  <div class="desc">
                    <p>This function calls extract and populate SGX data</p>
                    <h2 id="returns">Returns</h2>
                    <dl>
                      <dt><code>dataframe</code></dt>
                      <dd>Current SGX Ticker and information from SGX</dd>
                    </dl>
                  </div>
                  <details class="source">
                    <summary>
                      <span>Expand source code</span>
                    </summary>
                    <pre><code class="python">def get_SGX_data(self):
    &#34;&#34;&#34;This function calls extract and populate SGX data

    Returns:
        dataframe: Current SGX Ticker and information from SGX
    &#34;&#34;&#34;
    self.extract_SGX_json_data()
    self.populate_SGX_data()
    return self.SGX_data_store</code></pre>
                  </details>
                </dd>
                <dt
                  id="data_extract.SGXDataExtractor.SGXDataExtractor.load_SGX_data_from_source"
                >
                  <code class="name flex">
                    <span
                      >def
                      <span class="ident">load_SGX_data_from_source</span></span
                    >(<span>self)</span>
                  </code>
                </dt>
                <dd>
                  <div class="desc">
                    <p>This function calls extract and populate SGX data</p>
                  </div>
                  <details class="source">
                    <summary>
                      <span>Expand source code</span>
                    </summary>
                    <pre><code class="python">def load_SGX_data_from_source(self):
    &#34;&#34;&#34;This function calls extract and populate SGX data
    &#34;&#34;&#34;
    self.extract_SGX_json_data()
    self.populate_SGX_data()</code></pre>
                  </details>
                </dd>
                <dt
                  id="data_extract.SGXDataExtractor.SGXDataExtractor.populate_SGX_data"
                >
                  <code class="name flex">
                    <span>def <span class="ident">populate_SGX_data</span></span
                    >(<span>self)</span>
                  </code>
                </dt>
                <dd>
                  <div class="desc">
                    <p>Helper function to populate data from SGX JSON output</p>
                  </div>
                  <details class="source">
                    <summary>
                      <span>Expand source code</span>
                    </summary>
                    <pre><code class="python">def populate_SGX_data(self):
    &#34;&#34;&#34;Helper function to populate data from SGX JSON output
    &#34;&#34;&#34;
    print(&#34;INFO: Populating SGX Data Store&#34;)
    SGX_data_store = {
        &#34;company_name&#34;: [],
        &#34;ticker&#34;: [],
        &#34;trading_time&#34;: [],
        &#34;type&#34;: [],
        &#34;listing_board&#34;: []
    }
    for company in self.json_data:
        SGX_data_store[&#34;company_name&#34;].append(company[&#34;n&#34;])
        SGX_data_store[&#34;ticker&#34;].append(company[&#34;nc&#34;])
        SGX_data_store[&#34;trading_time&#34;].append(company[&#34;trading_time&#34;])
        SGX_data_store[&#34;type&#34;].append(company[&#34;type&#34;])
        SGX_data_store[&#34;listing_board&#34;].append(company[&#34;m&#34;])

    self.SGX_data_store = pd.DataFrame(SGX_data_store).dropna()
    self.SGX_data_store[&#39;active&#39;] = True
    print(&#34;SUCCESS: SGX Data successfully populated&#34;)</code></pre>
                  </details>
                </dd>
                <dt
                  id="data_extract.SGXDataExtractor.SGXDataExtractor.update_ticker_status"
                >
                  <code class="name flex">
                    <span
                      >def <span class="ident">update_ticker_status</span></span
                    >(<span>self, SGX_data_store, GBQ_SGX_ticker_df)</span>
                  </code>
                </dt>
                <dd>
                  <div class="desc">
                    <p>
                      This module checks newly extracted SGX data against
                      BigQuery SGX Ticker Table and updates the ticker statuses
                      Case 1 - Newly listed tickers Case 2 - Previously delisted
                      tickers Case 3 - Newly delisted tickers Case 4 -
                      Previously delisted tickers that are now active
                    </p>
                    <h2 id="args">Args</h2>
                    <dl>
                      <dt>
                        <strong><code>SGX_data_store</code></strong>
                        :&ensp;<code>list</code>
                      </dt>
                      <dd>List of existing tickers from SGX Website</dd>
                      <dt>
                        <strong><code>GBQ_SGX_ticker_df</code></strong>
                        :&ensp;<code>dataframe</code>
                      </dt>
                      <dd>Dataframe of tickers from SGX.Ticker Table</dd>
                    </dl>
                    <h2 id="returns">Returns</h2>
                    <dl>
                      <dt><code>datafarme</code></dt>
                      <dd>Dataframe of tickers and updated statuses</dd>
                    </dl>
                  </div>
                  <details class="source">
                    <summary>
                      <span>Expand source code</span>
                    </summary>
                    <pre><code class="python">def update_ticker_status(self, SGX_data_store, GBQ_SGX_ticker_df):
    &#34;&#34;&#34;This module checks newly extracted SGX data against BigQuery SGX Ticker Table and updates the ticker statuses
    Case 1 - Newly listed tickers
    Case 2 - Previously delisted tickers
    Case 3 - Newly delisted tickers
    Case 4 - Previously delisted tickers that are now active

    Args:
        SGX_data_store (list): List of existing tickers from SGX Website
        GBQ_SGX_ticker_df (dataframe): Dataframe of tickers from SGX.Ticker Table

    Returns:
        datafarme: Dataframe of tickers and updated statuses
    &#34;&#34;&#34;
    print(&#34;INFO: Updating ticker status&#34;)
    # 4 Cases to consider
    # Case 1 - Newly listed tickers
    # Case 2 - Previously delisted tickers
    # Case 3 - Newly delisted tickers
    # Case 4 - Previously delisted tickers that are now active

    # Getting active SGX tickers dataframe
    active_SGX_ticker_df = SGX_data_store
    active_SGX_ticker_list = active_SGX_ticker_df.ticker.to_list()

    if GBQ_SGX_ticker_df is None:
        self.updated_SGX_data_store = self.SGX_data_store
        return self.updated_SGX_data_store

    # Getting the list/dataframe of tickers from GBQ (Active and delisted)
    active_GBQ_ticker_df = GBQ_SGX_ticker_df[GBQ_SGX_ticker_df[&#39;active&#39;] == True]
    delisted_GBQ_ticker_df = GBQ_SGX_ticker_df[GBQ_SGX_ticker_df[&#39;active&#39;] == False]

    active_GBQ_ticker_list = active_GBQ_ticker_df.ticker.to_list()

    # This list contains either active tickers from SGX only or active tickers from GBQ only
    active_SGX_xor_active_GBQ_list = list(
        set(active_SGX_ticker_list) ^ set(active_GBQ_ticker_list))

    # Merges all tickers from SGX data store (all active - case 1 considered) and delisted GBQ dataframe (contains previously delisted tickers - case 2 is considered)
    # By dropping duplicates and keeping only the active one, case 4 is considered
    unique_columns = [&#34;company_name&#34;, &#34;ticker&#34;,
                      &#34;trading_time&#34;, &#34;type&#34;, &#34;listing_board&#34;]
    updated_SGX_data = pd.concat([active_SGX_ticker_df, delisted_GBQ_ticker_df]).drop_duplicates(
        subset=unique_columns, keep=&#39;first&#39;)

    for ticker in active_SGX_xor_active_GBQ_list:
        if ticker not in active_SGX_ticker_list:  # Changing status for newly delisted tickers - case 3 is considered
            newly_delisted_entry = active_GBQ_ticker_df.loc[active_GBQ_ticker_df[&#39;ticker&#39;] == ticker].copy(
            )

            newly_delisted_entry[&#39;active&#39;] = False
            updated_SGX_data = pd.concat(
                [updated_SGX_data, newly_delisted_entry])

    self.updated_SGX_data_store = updated_SGX_data.sort_values(
        [&#39;company_name&#39;, &#39;ticker&#39;]).reset_index(drop=True)

    self.updated_SGX_data_store = self.updated_SGX_data_store.drop_duplicates()

    print(&#34;SUCCESS: Ticker status Updated&#34;)

    return self.updated_SGX_data_store</code></pre>
                  </details>
                </dd>
              </dl>
            </dd>
          </dl>
        </section>
      </article>
      <nav id="sidebar">
        <h1>Index</h1>
        <div class="toc">
          <ul></ul>
        </div>
        <ul id="index">
          <li>
            <h3>Super-module</h3>
            <ul>
              <li>
                <code
                  ><a title="Syfr_API" href="../index.html"
                    >Syfr API Documentation</a
                  ></code
                >
              </li>
              <li>
                <code
                  ><a title="data_extract" href="index.html"
                    >data_extract</a
                  ></code
                >
              </li>
            </ul>
          </li>
          <li>
            <h3><a href="#header-classes">Classes</a></h3>
            <ul>
              <li>
                <h4>
                  <code
                    ><a
                      title="data_extract.SGXDataExtractor.SGXDataExtractor"
                      href="#data_extract.SGXDataExtractor.SGXDataExtractor"
                      >SGXDataExtractor</a
                    ></code
                  >
                </h4>
                <ul class="">
                  <li>
                    <code
                      ><a
                        title="data_extract.SGXDataExtractor.SGXDataExtractor.SGX_data_to_bg"
                        href="#data_extract.SGXDataExtractor.SGXDataExtractor.SGX_data_to_bg"
                        >SGX_data_to_bg</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="data_extract.SGXDataExtractor.SGXDataExtractor.SGX_data_to_csv"
                        href="#data_extract.SGXDataExtractor.SGXDataExtractor.SGX_data_to_csv"
                        >SGX_data_to_csv</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="data_extract.SGXDataExtractor.SGXDataExtractor.extract_SGX_json_data"
                        href="#data_extract.SGXDataExtractor.SGXDataExtractor.extract_SGX_json_data"
                        >extract_SGX_json_data</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="data_extract.SGXDataExtractor.SGXDataExtractor.get_SGXData_from_GBQ"
                        href="#data_extract.SGXDataExtractor.SGXDataExtractor.get_SGXData_from_GBQ"
                        >get_SGXData_from_GBQ</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="data_extract.SGXDataExtractor.SGXDataExtractor.get_SGX_data"
                        href="#data_extract.SGXDataExtractor.SGXDataExtractor.get_SGX_data"
                        >get_SGX_data</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="data_extract.SGXDataExtractor.SGXDataExtractor.load_SGX_data_from_source"
                        href="#data_extract.SGXDataExtractor.SGXDataExtractor.load_SGX_data_from_source"
                        >load_SGX_data_from_source</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="data_extract.SGXDataExtractor.SGXDataExtractor.populate_SGX_data"
                        href="#data_extract.SGXDataExtractor.SGXDataExtractor.populate_SGX_data"
                        >populate_SGX_data</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="data_extract.SGXDataExtractor.SGXDataExtractor.update_ticker_status"
                        href="#data_extract.SGXDataExtractor.SGXDataExtractor.update_ticker_status"
                        >update_ticker_status</a
                      ></code
                    >
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
    </main>
    <footer id="footer">
      <p>
        Generated by
        <a
          href="https://pdoc3.github.io/pdoc"
          title="pdoc: Python API documentation generator"
          ><cite>pdoc</cite> 0.10.0</a
        >.
      </p>
    </footer>
  </body>
</html>
